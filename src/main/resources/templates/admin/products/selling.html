<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{admin/layouts/admin-layout.html}">

<head>
<title>Quản lý sản phẩm</title>
</head>

<body>
	<main class="app-main">
		<div layout:fragment="content">
			<div class="container mt-4">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<h3 class="fw-bold mb-0">Quản lý sản phẩm</h3>
				</div>
				
				<div class="mb-3">
			        <a th:href="@{/admin/products/selling}" class="btn btn-success me-2">
			            Sản phẩm đang bán
			        </a>
			        <a th:href="@{/admin/products/pending}" class="btn btn-warning me-2">
			            Chờ phê duyệt
			        </a>
			        <a th:href="@{/admin/products/rejected}" class="btn btn-danger me-2">
			            Bị từ chối
			        </a>
			    </div>
				
				



				

					
						<div class="table-responsive shadow-sm rounded">
							<table class="table  table-hover align-middle">
								<thead class="table-success">
									<tr>
										<th scope="col">ID</th>
										<th scope="col">Tên sản phẩm</th>
										<th scope="col">Shop</th>
										<th scope="col">Trạng thái</th>
										<th scope="col">Hành động</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="product, iterStat : ${products}">


										<td th:text="${product.productID}"></td>
										<td>
											<div>
												<div class="fw-semibold" th:text="${product.productName}"></div>
												<span class="product-category"> <i
													class="bi bi-tag-fill me-1"></i> <span
													th:text="${product.category.categoryName}"></span>
												</span>
											</div>
										</td>

										<td><a class="text-decoration-none "> <span
												th:text="${product.shop.shopName}"></span>
										</a></td>

										<td><span
											class="badge rounded-pill fw-semibold px-3 py-2"
											th:classappend="${product.status == 1 ? 'bg-success-subtle text-success border border-success-subtle' : 'bg-secondary-subtle text-secondary border border-secondary-subtle'}">

												<i
												th:class="${product.status == 1 ? 								            'bi bi-check-circle-fill' : 
								            'bi bi-pause-circle-fill'}"></i>

												<span
												th:text="${product.status == 1 ? 'Hoạt động' : 'Tạm khóa'}"></span>
										</span></td>


										<td>
											<div class="d-flex gap-2 justify-content-start">
												<a
													th:href="@{'/admin/products/selling/detail/' + ${product.productID}}"
													class="btn btn-outline-info btn-sm "> <i
													class="bi bi-eye"></i>
												</a> <a
													th:href="@{'/admin/products/delete/' + ${product.productID}(page=${currentPage})}"
													class="btn btn-outline-danger btn-sm"> <i
													class="bi bi-trash3"></i>
												</a>


											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>



					<nav th:if="${totalPages > 1}" class="mt-4">
						<ul class="pagination justify-content-center flex-wrap">
							<li class="page-item"
								th:classappend="${currentPage == 1} ? 'disabled'"><a
								class="page-link rounded-pill shadow-sm border-0"
								th:href="@{'/admin/products?page=' + ${currentPage - 1}}"> <i
									class="bi bi-chevron-double-left"></i>
							</a></li>

							<li class="page-item" th:if="${currentPage > 3}"><a
								class="page-link rounded-pill shadow-sm border-0"
								th:href="@{'/admin/products?page=1'}">1</a></li>

							<li class="page-item disabled" th:if="${currentPage > 4}"><span
								class="page-link border-0 bg-transparent">...</span></li>

							<li class="page-item mx-1"
								th:each="page : ${#numbers.sequence(currentPage - 1, currentPage + 1)}"
								th:if="${page >= 1 and page <= totalPages}"
								th:classappend="${page == currentPage} ? 'active'"><a
								class="page-link rounded-pill shadow-sm border-0 fw-semibold"
								th:href="@{'/admin/products?page=' + ${page}}" th:text="${page}"></a>
							</li>

							<li class="page-item disabled"
								th:if="${currentPage < totalPages - 3}"><span
								class="page-link border-0 bg-transparent">...</span></li>

							<li class="page-item" th:if="${currentPage < totalPages - 2}">
								<a class="page-link rounded-pill shadow-sm border-0"
								th:href="@{'/admin/products?page=' + ${totalPages}}"
								th:text="${totalPages}"></a>
							</li>

							<li class="page-item"
								th:classappend="${currentPage == totalPages} ? 'disabled'"><a
								class="page-link rounded-pill shadow-sm border-0"
								th:href="@{'/admin/products?page=' + ${currentPage + 1}}"> <i
									class="bi bi-chevron-double-right"></i>
							</a></li>
						</ul>
					</nav>
				</div>
	
	
	</main>

	<th:block layout:fragment="scripts">
		<script>
        document.addEventListener("DOMContentLoaded", function () {
        	const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        	tooltipTriggerList.forEach(el => new bootstrap.Tooltip(el));
        	  
        	  
            const selectAll = document.getElementById("selectAll");
            const checkboxes = document.querySelectorAll(".selectItem");

            if (selectAll && checkboxes.length > 0) {
                // 1. Khi click vào checkbox "Chọn tất cả"
                selectAll.addEventListener("change", function () {
                    checkboxes.forEach(cb => {
                        cb.checked = this.checked;
                    });
                });

                // 2. Lắng nghe sự kiện trên từng checkbox con
                checkboxes.forEach(cb => {
                    cb.addEventListener("change", function () {
                        // Kiểm tra xem tất cả các checkbox con có được chọn hay không
                        const allChecked = Array.from(checkboxes).every(item => item.checked);
                        // Cập nhật lại trạng thái của checkbox "Chọn tất cả"
                        selectAll.checked = allChecked;
                    });
                });
            }
        });
        
        function clearFilters() {
        	document.querySelector('input[name="productName"]').value = '';
        	document.querySelector('input[name="categoryName"]').value = '';
        	document.querySelector('input[name="shopName"]').value = '';
        	document.querySelector('select[name="status"]').value = '';
        	
        	// Redirect to products page without filters
        	window.location.href = '/admin/products';
        }
    </script>
	</th:block>

</body>
</html>