<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout.html}">

<head>
	<title>Quản lý nhà vận chuyển</title>
</head>

<body>
	<main class="app-main">
		<div layout:fragment="content">
			<div class="container mt-4">

				<div class="d-flex justify-content-between align-items-center mb-3">
					<h3 class="fw-bold mb-0">Danh sách nhà vận chuyển</h3>
					<a th:href="@{'/admin/shippingProviders/add'}" class="btn btn-success rounded-pill">
	                    <i class="bi bi-person-plus-fill me-1"></i> Thêm nhà vận chuyển
	                </a>
				</div>

				<!-- Form tìm kiếm -->
				<div class="card shadow-sm border-0 mb-4">
					<div class="card-body">
						<form th:action="@{/admin/shippingProviders/search}" method="get">
							<div class="row g-3 align-items-end">
								<div class="col-md-4">
									<label class="form-label small fw-semibold text-muted">
										<i class="bi bi-truck me-1"></i>Tên nhà vận chuyển
									</label>
									<input type="text" name="providerName" th:value="${providerName}"
										class="form-control form-control-sm" placeholder="Nhập tên nhà vận chuyển...">
								</div>

								<div class="col-md-3">
									<label class="form-label small fw-semibold text-muted">
										<i class="bi bi-cash-coin me-1"></i>Phí cơ bản
									</label>
									<input type="number" step="1000" name="baseFee" th:value="${baseFee}"
										class="form-control form-control-sm" placeholder="Nhập phí cơ bản...">
								</div>

								<div class="col-md-2">
									<label class="form-label small fw-semibold text-muted">
										<i class="bi bi-flag-fill me-1"></i>Trạng thái
									</label>
									<select name="status" class="form-select form-select-sm" th:value="${status}">
										<option value="">Tất cả</option>
										<option value="0" th:selected="${status == '0'}">Ngưng hoạt động</option>
										<option value="1" th:selected="${status == '1'}">Hoạt động</option>
									</select>
								</div>

								<div class="col-md-3 d-flex gap-2">
									<button type="submit" class="btn btn-success btn-sm flex-fill rounded-pill">
										<i class="bi bi-search me-1"></i>Tìm kiếm
									</button>
									<button type="button" onclick="clearFilters()"
										class="btn btn-outline-secondary btn-sm rounded-pill">
										<i class="bi bi-x-circle"></i>
									</button>
								</div>
							</div>
						</form>
					</div>
				</div>

				<!-- Bảng danh sách -->
				<div class="table-responsive shadow-sm rounded">
					<table class="table table-striped table-hover align-middle">
						<thead class="table-success">
							<tr>
								<th scope="col"><input type="checkbox" id="selectAll" class="form-check-input"></th>
								<th scope="col">STT</th>
								<th scope="col">Tên nhà vận chuyển</th>
								<th scope="col">Phí cơ bản (VNĐ)</th>
								<th scope="col">Trạng thái</th>
								<th scope="col">Hành động</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="provider, iterStat : ${shippingProviders}">
								<td><input type="checkbox" name="selectedIds" th:value="${provider.providerId}"
										class="form-check-input selectItem"></td>
								<td th:text="${iterStat.index + 1}"></td>

								<td th:text="${provider.providerName}"></td>

								<td th:text="${#numbers.formatDecimal(provider.baseFee, 0, 'COMMA', 0, 'POINT')}"></td>

								<td>
									<span class="badge rounded-pill fw-semibold px-3 py-2"
										th:classappend="${provider.status == 1 ? 'bg-success-subtle text-success border border-success-subtle' : 'bg-danger-subtle text-danger border border-danger-subtle'}">
										<i
											th:class="${provider.status == 1 ? 'bi bi-check-circle-fill' : 'bi bi-x-circle-fill'}"></i>
										<span
											th:text="${provider.status == 1 ? 'Hoạt động' : 'Ngưng hoạt động'}"></span>
									</span>
								</td>

								<td>
									<div class="d-flex gap-2 justify-content-start">
										<a th:href="@{'/admin/shippingProviders/edit/' + ${provider.providerId}}"
											class="btn btn-outline-warning btn-sm">
											<i class="bi bi-pencil-square"></i> Sửa
										</a>

										<a th:href="@{'/admin/shippingProviders/delete/' + ${provider.providerId} + '?page=' + ${currentPage} + ''}"
										   class="btn btn-outline-danger btn-sm"
										   onclick="return confirm('Bạn có chắc chắn muốn xóa nhà cung cấp này không?');">
										   <i class="bi bi-trash3"></i> Xóa
										</a>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<!-- Phân trang -->
				<nav th:if="${totalPages > 1}" class="mt-4">
					<ul class="pagination justify-content-center flex-wrap">
						<li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
							<a class="page-link rounded-pill shadow-sm border-0"
								th:href="@{'/admin/shippingProviders?page=' + ${currentPage - 1}}">
								<i class="bi bi-chevron-double-left"></i>
							</a>
						</li>

						<li class="page-item" th:if="${currentPage > 3}">
							<a class="page-link rounded-pill shadow-sm border-0"
								th:href="@{'/admin/shippingProviders?page=1'}">1</a>
						</li>

						<li class="page-item disabled" th:if="${currentPage > 4}">
							<span class="page-link border-0 bg-transparent">...</span>
						</li>

						<li class="page-item mx-1"
							th:each="page : ${#numbers.sequence(currentPage - 1, currentPage + 1)}"
							th:if="${page >= 1 and page <= totalPages}"
							th:classappend="${page == currentPage} ? 'active'">
							<a class="page-link rounded-pill shadow-sm border-0 fw-semibold"
								th:href="@{'/admin/shippingProviders?page=' + ${page}}" th:text="${page}"></a>
						</li>

						<li class="page-item disabled" th:if="${currentPage < totalPages - 3}">
							<span class="page-link border-0 bg-transparent">...</span>
						</li>

						<li class="page-item" th:if="${currentPage < totalPages - 2}">
							<a class="page-link rounded-pill shadow-sm border-0"
								th:href="@{'/admin/shippingProviders?page=' + ${totalPages}}"
								th:text="${totalPages}"></a>
						</li>

						<li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
							<a class="page-link rounded-pill shadow-sm border-0"
								th:href="@{'/admin/shippingProviders?page=' + ${currentPage + 1}}">
								<i class="bi bi-chevron-double-right"></i>
							</a>
						</li>
					</ul>
				</nav>

			</div>
		</div>
	</main>
	<th:block layout:fragment="scripts">
		<script>
        
        function clearFilters() {
        	document.querySelector('input[name="providerName"]').value = '';
        	document.querySelector('input[name="baseFee"]').value = '';
        	document.querySelector('select[name="status"]').value = '';
        	
        	// Redirect to products page without filters
        	window.location.href = '/admin/shippingProviders';
        }
    </script>
	</th:block>
</body>

</html>
