<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{vendor/layouts/vendor-layout}" lang="vi">
<head>
<meta charset="UTF-8">
<title>Thông tin cửa hàng - Vendor | AloTra</title>

<style>
.shop-logo-preview {
	width: 150px;
	height: 150px;
	object-fit: cover;
	border-radius: 10px;
	border: 3px solid #dee2e6;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.shop-cover-preview {
	width: 100%;
	max-height: 250px;
	object-fit: cover;
	border-radius: 10px;
	border: 2px solid #dee2e6;
}

.image-upload-container {
	position: relative;
	display: inline-block;
}

.image-upload-overlay {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background: rgba(0, 0, 0, 0.6);
	display: flex;
	align-items: center;
	justify-content: center;
	opacity: 0;
	transition: opacity 0.3s;
	cursor: pointer;
	border-radius: 10px;
}

.image-upload-container:hover .image-upload-overlay {
	opacity: 1;
}

.readonly-field {
	background-color: #f8f9fa;
	cursor: not-allowed;
	border: 1px solid #dee2e6;
}

.info-badge {
	font-size: 0.9rem;
	padding: 0.5rem 1rem;
}

.stat-card {
	border-left: 4px solid #007bff;
	transition: transform 0.2s;
}

.stat-card:hover {
	transform: translateY(-2px);
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.section-card {
	border: none;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
	margin-bottom: 1.5rem;
}

.section-header {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	color: white;
	padding: 1rem 1.5rem;
	border-radius: 0.5rem 0.5rem 0 0;
}

.form-label {
	font-weight: 600;
	color: #495057;
	margin-bottom: 0.5rem;
}

.form-control:focus {
	border-color: #667eea;
	box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.btn-primary {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	border: none;
}

.btn-primary:hover {
	background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%);
}
</style>
</head>
<body>

	<div layout:fragment="content">

		<!-- Page Header -->
		<div
			class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
			<h1 class="h2">
				<i class="bi bi-shop"></i> Thông tin cửa hàng
			</h1>
			<div class="btn-toolbar mb-2 mb-md-0">
				<a th:href="@{/vendor/dashboard}"
					class="btn btn-sm btn-outline-secondary"> <i
					class="bi bi-arrow-left"></i> Quay lại Dashboard
				</a>
			</div>
		</div>

		<!-- Flash Messages -->
		<div th:if="${success}"
			class="alert alert-success alert-dismissible fade show" role="alert">
			<i class="bi bi-check-circle"></i> <span th:text="${success}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>

		<div th:if="${error}"
			class="alert alert-danger alert-dismissible fade show" role="alert">
			<i class="bi bi-exclamation-triangle"></i> <span th:text="${error}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>

		<form th:action="@{/vendor/shop-profile/update}" th:object="${shop}"
			method="post" enctype="multipart/form-data">

			<!-- Status & Commission Cards -->
			<div class="row g-4 mb-4">
				<div class="col-md-4">
					<div class="card stat-card h-100">
						<div class="card-body">
							<div class="d-flex justify-content-between align-items-center">
								<div>
									<p class="text-muted mb-1">Trạng thái cửa hàng</p>
									<h5 class="mb-0">
										<span class="badge"
											th:classappend="${shop.status == 1} ? 'bg-success' : (${shop.status == 0} ? 'bg-warning' : 'bg-danger')"
											th:text="${shop.statusText}"> </span>
									</h5>
								</div>
								<i class="bi bi-check-circle-fill fs-1"
									th:classappend="${shop.status == 1} ? 'text-success' : 'text-muted'"
									style="opacity: 0.3;"></i>
							</div>
						</div>
					</div>
				</div>

				<div class="col-md-4">
					<div class="card stat-card h-100"
						style="border-left-color: #17a2b8;">
						<div class="card-body">
							<div class="d-flex justify-content-between align-items-center">
								<div>
									<p class="text-muted mb-1">Tỷ lệ hoa hồng</p>
									<h5 class="mb-0">
										<span class="badge bg-info"> <i class="bi bi-percent"></i>
											<span th:text="${shop.commissionRate}"></span>%
										</span>
									</h5>
									<small class="text-muted">Do admin quản lý</small>
								</div>
								<i class="bi bi-cash-coin fs-1 text-info" style="opacity: 0.3;"></i>
							</div>
						</div>
					</div>
				</div>

				<div class="col-md-4">
					<div class="card stat-card h-100"
						style="border-left-color: #28a745;">
						<div class="card-body">
							<div class="d-flex justify-content-between align-items-center">
								<div>
									<p class="text-muted mb-1">Ngày tạo shop</p>
									<h6 class="mb-0">
										<span
											th:text="${#temporals.format(shop.createdAt, 'dd/MM/yyyy')}"></span>
									</h6>
									<small class="text-muted"> Cập nhật: <span
										th:text="${#temporals.format(shop.updatedAt, 'dd/MM/yyyy')}"></span>
									</small>
								</div>
								<i class="bi bi-calendar-check fs-1 text-success"
									style="opacity: 0.3;"></i>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Cover Image Section -->
			<div class="card section-card">
				<div class="section-header">
					<h5 class="mb-0">
						<i class="bi bi-image"></i> Hình ảnh cửa hàng
					</h5>
				</div>
				<div class="card-body">
					<div class="row">
						<!-- Cover Image -->
						<div class="col-md-8 mb-4">
							<label class="form-label">Ảnh bìa cửa hàng</label>
							<div class="image-upload-container w-100">
								<img
									th:src="${shop.coverImageURL != null ? shop.coverImageURL : '/assets/img/default-cover.jpg'}"
									id="coverPreview" class="shop-cover-preview w-100"
									alt="Cover Image">
								<div class="image-upload-overlay"
									onclick="document.getElementById('coverImageFile').click()">
									<div class="text-white text-center">
										<i class="bi bi-camera-fill fs-1"></i>
										<p class="mb-0 mt-2">Thay đổi ảnh bìa</p>
									</div>
								</div>
							</div>
							<input type="file" id="coverImageFile"
								th:field="*{coverImageFile}" class="d-none" accept="image/*"
								onchange="previewImage(this, 'coverPreview')"> <small
								class="form-text text-muted"> <i
								class="bi bi-info-circle"></i> Khuyến nghị: 1200x400px, JPG/PNG,
								tối đa 5MB
							</small>
						</div>

						<!-- Logo -->
						<div class="col-md-4 mb-4">
							<label class="form-label">Logo cửa hàng</label>
							<div class="image-upload-container d-block text-center">
								<img
									th:src="${shop.logoURL != null ? shop.logoURL : '/assets/img/default-logo.jpg'}"
									id="logoPreview" class="shop-logo-preview" alt="Shop Logo">
								<div class="image-upload-overlay"
									onclick="document.getElementById('logoFile').click()">
									<div class="text-white text-center">
										<i class="bi bi-camera-fill fs-3"></i>
										<p class="mb-0 small mt-2">Đổi logo</p>
									</div>
								</div>
							</div>
							<input type="file" id="logoFile" th:field="*{logoFile}"
								class="d-none" accept="image/*"
								onchange="previewImage(this, 'logoPreview')"> <small
								class="form-text text-muted d-block text-center mt-2"> <i
								class="bi bi-info-circle"></i> 300x300px, JPG/PNG, tối đa 2MB
							</small>
						</div>
					</div>
				</div>
			</div>

			<!-- Basic Information Section -->
			<div class="card section-card">
				<div class="section-header">
					<h5 class="mb-0">
						<i class="bi bi-pencil-square"></i> Thông tin cơ bản
					</h5>
				</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-6 mb-3">
							<label for="shopName" class="form-label"> Tên cửa hàng <span
								class="text-danger">*</span>
							</label>
							<div class="input-group">
								<span class="input-group-text"><i class="bi bi-shop"></i></span>
								<input type="text" class="form-control" id="shopName"
									th:field="*{shopName}" placeholder="Nhập tên cửa hàng" required>
							</div>
							<div class="invalid-feedback">Vui lòng nhập tên cửa hàng
								(3-255 ký tự)</div>
						</div>

						<div class="col-md-6 mb-3">
							<label for="phoneNumber" class="form-label"> Số điện
								thoại <span class="text-danger">*</span>
							</label>
							<div class="input-group">
								<span class="input-group-text"><i class="bi bi-telephone"></i></span>
								<input type="tel" class="form-control" id="phoneNumber"
									th:field="*{phoneNumber}" placeholder="0xxxxxxxxx"
									pattern="^0[0-9]{9}$" required>
							</div>
							<div class="invalid-feedback">Số điện thoại phải là 10 số,
								bắt đầu bằng 0</div>
						</div>
					</div>

					<div class="mb-3">
						<label for="address" class="form-label"> Địa chỉ <span
							class="text-danger">*</span>
						</label>
						<div class="input-group">
							<span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
							<input type="text" class="form-control" id="address"
								th:field="*{address}" placeholder="Nhập địa chỉ cửa hàng"
								required>
						</div>
						<div class="invalid-feedback">Vui lòng nhập địa chỉ cửa hàng</div>
					</div>

					<div class="mb-3">
						<label for="description" class="form-label">Mô tả cửa hàng</label>
						<textarea class="form-control" id="description"
							th:field="*{description}" rows="5"
							placeholder="Giới thiệu về cửa hàng của bạn..."></textarea>
						<small class="form-text text-muted"> <i
							class="bi bi-info-circle"></i> Tối đa 5000 ký tự
						</small>
					</div>
				</div>
			</div>

			<!-- Owner Information Section -->
			<div class="card section-card">
				<div class="card-header bg-light">
					<h6 class="mb-0">
						<i class="bi bi-person-circle"></i> Thông tin chủ cửa hàng
					</h6>
				</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-6 mb-3">
							<label class="form-label">Họ và tên</label>
							<div class="input-group">
								<span class="input-group-text"><i class="bi bi-person"></i></span>
								<input type="text" class="form-control readonly-field"
									th:value="${shop.ownerName}" readonly>
							</div>
						</div>
						<div class="col-md-6 mb-3">
							<label class="form-label">Email</label>
							<div class="input-group">
								<span class="input-group-text"><i class="bi bi-envelope"></i></span>
								<input type="email" class="form-control readonly-field"
									th:value="${shop.ownerEmail}" readonly>
							</div>
						</div>
					</div>
					<div class="alert alert-info mb-0" role="alert">
						<i class="bi bi-info-circle-fill"></i> Thông tin chủ cửa hàng
						không thể thay đổi. Vui lòng liên hệ admin nếu cần cập nhật.
					</div>
				</div>
			</div>

			<!-- Action Buttons -->
			<div class="d-flex justify-content-between align-items-center mb-4">
				<small class="text-muted"> <i class="bi bi-shield-check"></i>
					Tất cả thay đổi sẽ được lưu ngay lập tức
				</small>
				<div class="d-flex gap-2">
					<a th:href="@{/vendor/dashboard}" class="btn btn-secondary"> <i
						class="bi bi-x-circle"></i> Hủy bỏ
					</a>
					<button type="submit" class="btn btn-primary">
						<i class="bi bi-save"></i> Lưu thay đổi
					</button>
				</div>
			</div>
		</form>

	</div>

	<th:block layout:fragment="scripts">
		<script>
        // Image preview function
        function previewImage(input, previewId) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // Validate file size
                const maxSize = previewId === 'coverPreview' ? 5 * 1024 * 1024 : 2 * 1024 * 1024; // 5MB for cover, 2MB for logo
                if (file.size > maxSize) {
                    alert('Kích thước file quá lớn! Vui lòng chọn file nhỏ hơn ' + (maxSize / 1024 / 1024) + 'MB');
                    input.value = '';
                    return;
                }
                
                // Validate file type
                if (!file.type.match('image.*')) {
                    alert('Vui lòng chọn file hình ảnh (JPG, PNG)');
                    input.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(previewId).src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // Form validation
        (function() {
            'use strict';
            const forms = document.querySelectorAll('form');
            Array.from(forms).forEach(function(form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();

        // Auto-dismiss alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }, 5000);
            });
        });
    </script>
	</th:block>
</body>
</html>