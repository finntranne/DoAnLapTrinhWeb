<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{vendor/layouts/vendor-layout}" lang="vi">
<head>
<meta charset="UTF-8">
<title>Trạng thái Phê duyệt - Vendor | AloTra</title>
</head>
<body>

	<div layout:fragment="content">

		<div
			class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
			<h1 class="h2">
				<i class="bi bi-hourglass-split"></i> Trạng thái Phê duyệt
			</h1>
			<a th:href="@{/vendor/dashboard}" class="btn btn-outline-secondary">
				<i class="bi bi-arrow-left"></i> Quay lại Dashboard
			</a>
		</div>

		<div th:if="${success}"
			class="alert alert-success alert-dismissible fade show" role="alert">
			<i class="bi bi-check-circle"></i> <span th:text="${success}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"
				aria-label="Close"></button>
		</div>
		<div th:if="${error}"
			class="alert alert-danger alert-dismissible fade show" role="alert">
			<i class="bi bi-exclamation-triangle"></i> <span th:text="${error}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"
				aria-label="Close"></button>
		</div>
		<div class="card mb-4">
			<div class="card-body">
			<form method="get" th:action="@{/vendor/approvals}" class="row g-3 align-items-end">
					<div class="col-md-4">
						<label for="entityType" class="form-label">Loại đối tượng</label>
                        <select class="form-select" id="entityType" name="entityType">
                            <option value="">-- Tất cả --</option>
                            <option value="PRODUCT" th:selected="${entityType == 'PRODUCT'}">Sản phẩm</option>
                            <option value="PROMOTION" th:selected="${entityType == 'PROMOTION'}">Khuyến mãi</option>
                        </select>
					</div>
                    <div class="col-md-4">
						<label for="actionType" class="form-label">Hành động</label>
                        <select class="form-select" id="actionType" name="actionType">
                            <option value="">-- Tất cả --</option>
                            <option value="CREATE" th:selected="${actionType == 'CREATE'}">Tạo mới</option>
                            <option value="UPDATE" th:selected="${actionType == 'UPDATE'}">Cập nhật</option>
                            <option value="DELETE" th:selected="${actionType == 'DELETE'}">Yêu cầu xóa</option>
                        </select>
					</div>
					<div class="col-md-4 d-flex">
						<button type="submit" class="btn btn-primary me-2">
							<i class="bi bi-funnel"></i> Lọc
						</button>
						<a th:href="@{/vendor/approvals}" class="btn btn-outline-secondary">
							<i class="bi bi-arrow-clockwise"></i> Đặt lại
						</a>
					</div>
				</form>
			</div>
		</div>
		<div class="card">
			<div class="card-header">
				<h5 class="card-title mb-0">
					<i class="bi bi-list-task me-2"></i>Yêu cầu đang chờ xử lý
				</h5>
			</div>
			<div class="card-body">
				<div th:if="${approvals == null or approvals.isEmpty()}"
					class="text-center text-muted py-5">
					<i class="bi bi-check2-circle" style="font-size: 3rem;"></i>
					<p class="mt-2">Không có yêu cầu nào đang chờ phê duyệt.</p>
				</div>

				<div th:if="${approvals != null and !approvals.isEmpty()}"
					class="table-responsive">
					<table class="table table-hover align-middle">
						<thead class="table-light">
							<tr>
								<th>Loại</th>
								<th>Đối tượng</th>
								<th>Hành động</th>
								<th>Trạng thái</th>
								<th>Ngày yêu cầu</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="approval : ${approvals}">
								<td><span th:if="${approval.entityType == 'PRODUCT'}"
									class="badge bg-primary"> <i class="bi bi-box-seam me-1"></i>
										Sản phẩm
								</span> <span th:if="${approval.entityType == 'PROMOTION'}"
									class="badge bg-info text-dark"> <i
										class="bi bi-gift me-1"></i> Khuyến mãi
								</span></td>
								<td><span
									th:text="${approval.entityName != null ? approval.entityName : '(ID: ' + approval.entityId + ')'}"></span>
								</td>
								<td><span th:switch="${approval.actionType}"> <span
										th:case="'CREATE'" class="text-success fw-bold">Tạo mới</span>
										<span th:case="'UPDATE'" class="text-primary fw-bold">Cập
											nhật</span> <span th:case="'DELETE'" class="text-danger fw-bold">Yêu
											cầu xóa</span> <span th:case="*" th:text="${approval.actionType}"></span>
								</span></td>
								<td><span class="badge bg-warning text-dark"
									th:text="${approval.status}"> </span></td>
								<td><span
									th:text="${#temporals.format(approval.requestedAt, 'dd/MM/yyyy HH:mm')}"></span>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div th:if="${approvals != null and !approvals.isEmpty()}"
					class="alert alert-info mt-3 mb-0">
					<i class="bi bi-info-circle me-1"></i> Các yêu cầu này đang chờ
					Admin xem xét. Bạn không thể gửi yêu cầu mới (Cập nhật/Xóa) cho các
					đối tượng này cho đến khi yêu cầu hiện tại được xử lý.
				</div>
			</div>
		</div>
	</div>
</body>
</html>